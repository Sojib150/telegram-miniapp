<!DOCTYPE html>
<html lang="bn">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Banana Pop Game</title>
  <link rel="stylesheet" href="style.css">

  <!-- Monetag SDK -->
  <script src='//libtl.com/sdk.js' data-zone='9931551' data-sdk='show_9931551'></script>

  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js"></script>
</head>
<body style="background: linear-gradient(135deg,#fef3c7,#fde68a); overflow:hidden;">
  
  <div id="scoreBoard">🍌 স্কোর: <span id="score">0</span></div>
  <canvas id="gameCanvas" width="360" height="500"></canvas>

  <script>
    // ================= Firebase Setup =================
    const firebaseConfig = {
      apiKey: "AIzaSyB6b93A_HeU4FADs3o2Ysw6-dlRRS2TbZk",
      authDomain: "telegram-miniapp-e8cc0.firebaseapp.com",
      projectId: "telegram-miniapp-e8cc0",
      storageBucket: "telegram-miniapp-e8cc0.firebasestorage.app",
      messagingSenderId: "827930913054",
      appId: "1:827930913054:web:502b56e0c198d8e9ff410f"
    };
    const app = firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    // ইউজারের টেলিগ্রাম আইডি (পরে টেলিগ্রাম থেকে আসবে, এখন ডেমো হিসেবে)
    const userId = "demo_user";

    async function updateCoins(amount) {
      const ref = db.collection("users").doc(userId);
      await ref.set(
        { coins: firebase.firestore.FieldValue.increment(amount) },
        { merge: true }
      );
    }

    // ================= Game Setup =================
    const canvas = document.getElementById("gameCanvas");
    const ctx = canvas.getContext("2d");

    let bananas = [];
    let score = 0;

    const bananaImg = new Image();
    bananaImg.src = "https://i.ibb.co/6ZspsD1/banana.png";

    function createBanana() {
      const x = Math.random() * (canvas.width - 50);
      bananas.push({ x: x, y: -50, w: 50, h: 50 });
    }

    function update() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);

      bananas.forEach((banana, index) => {
        banana.y += 3;
        ctx.drawImage(bananaImg, banana.x, banana.y, banana.w, banana.h);

        if (banana.y > canvas.height) {
          bananas.splice(index, 1);
        }
      });

      requestAnimationFrame(update);
    }

    canvas.addEventListener("click", (e) => {
      const rect = canvas.getBoundingClientRect();
      const mouseX = e.clientX - rect.left;
      const mouseY = e.clientY - rect.top;

      bananas.forEach((banana, index) => {
        if (
          mouseX >= banana.x &&
          mouseX <= banana.x + banana.w &&
          mouseY >= banana.y &&
          mouseY <= banana.y + banana.h
        ) {
          bananas.splice(index, 1);
          score += 10;
          document.getElementById("score").innerText = score;

          // Firebase এ কয়েন যোগ
          updateCoins(10);

          // প্রতি ৫০ পয়েন্ট পর এড দেখাও
          if (score % 50 === 0) {
            if (typeof Monetag !== "undefined" && Monetag.show_9931551) {
              Monetag.show_9931551();
            }
          }
        }
      });
    });

    setInterval(createBanana, 1500);
    update();
  </script>
</body>
</html>
