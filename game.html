<!DOCTYPE html>
<html lang="bn">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Play Game</title>
  <link rel="stylesheet" href="style.css">

  <!-- Monetag SDK -->
  <script src='//libtl.com/sdk.js' data-zone='9931551' data-sdk='show_9931551'></script>

  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js"></script>
</head>
<body>
  <div class="container">
    <h2>ðŸŽ® Banana Catch Game</h2>
    <canvas id="gameCanvas" width="300" height="400" style="border:1px solid #000;"></canvas>
    <p id="gameStatus"></p>
  </div>

  <script>
    // Firebase config
    const firebaseConfig = {
      apiKey: "AIzaSyB6b93A_HeU4FADs3o2Ysw6-dlRRS2TbZk",
      authDomain: "telegram-miniapp-e8cc0.firebaseapp.com",
      projectId: "telegram-miniapp-e8cc0",
      storageBucket: "telegram-miniapp-e8cc0.firebasestorage.app",
      messagingSenderId: "827930913054",
      appId: "1:827930913054:web:502b56e0c198d8e9ff410f"
    };

    const app = firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();
    const userId = "demoUser123"; // à¦ªà¦°à§‡ Telegram à¦…à¦Ÿà§‹-à¦²à¦—à¦‡à¦¨ à¦¬à¦¸à¦¬à§‡

    // Simple Banana Game
    const canvas = document.getElementById("gameCanvas");
    const ctx = canvas.getContext("2d");

    let bananaY = 0;
    let score = 0;

    function drawGame() {
      ctx.clearRect(0,0,canvas.width,canvas.height);
      ctx.fillStyle = "yellow";
      ctx.beginPath();
      ctx.arc(150, bananaY, 20, 0, Math.PI*2);
      ctx.fill();

      bananaY += 5;
      if (bananaY > 400) {
        gameOver();
      } else {
        requestAnimationFrame(drawGame);
      }
    }

    function gameOver() {
      document.getElementById("gameStatus").innerText = "Game Over! ðŸŒ +5 Coins";
      rewardUser(5); // à¦•à§Ÿà§‡à¦¨ à¦¯à§‹à¦—
      // Ad Show
      show_9931551().then(() => console.log("Ad shown after game!"));
    }

    drawGame();

    async function rewardUser(amount) {
      const userRef = db.collection("users").doc(userId);
      const docSnap = await userRef.get();
      if (docSnap.exists) {
        let currentCoins = docSnap.data().coins || 0;
        await userRef.update({ coins: currentCoins + amount });
      } else {
        await userRef.set({ coins: amount });
      }
    }
  </script>
</body>
</html>
