<!DOCTYPE html>
<html lang="bn">
<head>
  <meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Watch Ad & Earn</title>
  <script async src="https://alwingulla.com/88/tag.min.js" data-zone="9931551" data-cfasync="false"></script>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <div class="container">
    <div class="card center">
      <h2>üì∫ ‡¶¨‡¶ø‡¶ú‡ßç‡¶û‡¶æ‡¶™‡¶® ‡¶¶‡ßá‡¶ñ‡ßá ‡¶Ü‡ßü ‡¶ï‡¶∞‡ßÅ‡¶®</h2>
      <p class="small">‡ßß‡ß´ ‡¶∏‡ßá‡¶ï‡ßá‡¶®‡ßç‡¶° ‡¶¶‡ßá‡¶ñ‡ßÅ‡¶®, ‡¶™‡¶∞‡ßá ‡ßß‡ß¶ ‡¶ï‡ßü‡ßá‡¶® ‡¶®‡¶ø‡¶®</p>

      <div class="ad-box" style="margin-top:12px">
        <!-- Monetag ad placeholder -->
        <div id="monetag_area"></div>
      </div>

      <button id="startAd" class="btn" style="margin-top:12px">‚ñ∂ Start Ad (15s)</button>
      <button id="claimAd" class="btn ghost" disabled style="margin-top:8px">‚úÖ Claim 10 Coins</button>
      <p class="small" id="status"></p>
    </div>
  </div>

  <script type="module" src="app.js"></script>
  <script src="ads.js"></script>
  <script>
    (function(){
      const start = document.getElementById('startAd');
      const claim = document.getElementById('claimAd');
      const status = document.getElementById('status');

      start.addEventListener('click', ()=>{
        status.innerText = '‚è≥ Waiting 15s...';
        start.disabled = true;
        // show popup ad (optional) and start timer
        if(window.ADS && window.ADS.showRewardedPopup) window.ADS.showRewardedPopup().catch(()=>{/*ignore*/});
        let t=15;
        const id = setInterval(()=> {
          t--; status.innerText = `‚è≥ ${t}s remaining`;
          if(t<=0){ clearInterval(id); claim.disabled=false; status.innerText='‚úÖ Ready to claim'; }
        },1000);
      });

      claim.addEventListener('click', async ()=>{
        // reward via ads wrapper to ensure server credit (we also call Monetag rewarded interstitial for confirmation)
        try {
          if(window.ADS && window.ADS.showRewardedInterstitial){
            await window.ADS.showRewardedInterstitial(); // this will also call rewardUserCoins
          } else {
            // fallback: direct reward
            const user = window.appHelpers.getTelegramUser();
            const id = user?.id || localStorage.getItem('guest_user');
            await window.appHelpers.addCoinsToUser(id, 10);
          }
          status.innerText = '‚úÖ Claimed 10 coins';
          claim.disabled = true;
          start.disabled = false;
        } catch(e){
          status.innerText = '‚ö†Ô∏è Ad not available, try again';
          start.disabled = false;
        }
      });
    })();
  </script>
</body>
</html>
