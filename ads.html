<!DOCTYPE html>
<html lang="bn">
<head>
  <meta charset="UTF-8">
  <title>Ads - Earn Coins</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <h1>üéÅ ‡¶è‡¶° ‡¶¶‡ßá‡¶ñ‡ßá ‡¶ï‡ßü‡ßá‡¶® ‡¶ú‡¶Æ‡¶æ‡¶ì</h1>

  <div id="ad-section">
    <!-- ‡¶è‡¶ñ‡¶æ‡¶®‡ßá ‡¶è‡¶° ‡¶≤‡ßã‡¶° ‡¶π‡¶¨‡ßá -->
    <iframe id="ad-frame" src="https://www.profitabledisplaynetwork.com/a7/79/35/a7793522c5f18d71ee839b6a1b35e1eb.js" 
            style="width:100%; height:250px; border:none;"></iframe>
  </div>

  <div id="timer-box" style="display:none;">
    ‚è≥ ‡¶è‡¶° ‡¶∂‡ßá‡¶∑ ‡¶π‡¶§‡ßá <span id="countdown">15</span> ‡¶∏‡ßá‡¶ï‡ßá‡¶®‡ßç‡¶° ‡¶¨‡¶æ‡¶ï‡¶ø...
  </div>

  <button id="claimBtn" disabled>‚úÖ ‡¶ï‡ßü‡ßá‡¶® Claim ‡¶ï‡¶∞‡ßã</button>

  <p id="status"></p>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
    import { getFirestore, doc, getDoc, updateDoc, setDoc, increment } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-firestore.js";

    // Firebase config
    const firebaseConfig = {
      apiKey: "AIzaSyB6b93A_HeU4FADs3o2Ysw6-dlRRS2TbZk",
      authDomain: "telegram-miniapp-e8cc0.firebaseapp.com",
      projectId: "telegram-miniapp-e8cc0",
      storageBucket: "telegram-miniapp-e8cc0.firebasestorage.app",
      messagingSenderId: "827930913054",
      appId: "1:827930913054:web:502b56e0c198d8e9ff410f"
    };

    // Firebase init
    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    const claimBtn = document.getElementById("claimBtn");
    const countdownEl = document.getElementById("countdown");
    const timerBox = document.getElementById("timer-box");
    const statusEl = document.getElementById("status");

    let timer;

    // ‡¶è‡¶°‡ßá ‡¶ï‡ßç‡¶≤‡¶ø‡¶ï ‡¶ï‡¶∞‡¶≤‡ßá ‡¶ü‡¶æ‡¶á‡¶Æ‡¶æ‡¶∞ ‡¶∂‡ßÅ‡¶∞‡ßÅ
    document.getElementById("ad-frame").addEventListener("click", () => {
      let timeLeft = 15;
      timerBox.style.display = "block";
      claimBtn.disabled = true;
      countdownEl.textContent = timeLeft;

      timer = setInterval(() => {
        timeLeft--;
        countdownEl.textContent = timeLeft;
        if (timeLeft <= 0) {
          clearInterval(timer);
          claimBtn.disabled = false;
          statusEl.textContent = "üéâ Claim ‡¶ï‡¶∞‡¶§‡ßá ‡¶™‡¶æ‡¶∞‡¶¨‡ßá‡¶® ‡¶è‡¶ñ‡¶®!";
        }
      }, 1000);
    });

    // Claim ‡¶ï‡¶∞‡¶≤‡ßá ‡¶ï‡ßü‡ßá‡¶® Firebase ‡¶è ‡¶Ø‡ßã‡¶ó ‡¶π‡¶¨‡ßá
    claimBtn.addEventListener("click", async () => {
      const username = localStorage.getItem("username");
      if (!username) {
        alert("‚ö†Ô∏è ‡¶Ü‡¶ó‡ßá ‡¶≤‡¶ó‡¶á‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®!");
        return;
      }

      const userRef = doc(db, "users", username);
      const snap = await getDoc(userRef);

      if (!snap.exists()) {
        await setDoc(userRef, { username, coins: 0 });
      }

      await updateDoc(userRef, {
        coins: increment(10) // ‡¶™‡ßç‡¶∞‡¶§‡¶ø‡¶¨‡¶æ‡¶∞ 10 ‡¶ï‡ßü‡ßá‡¶® ‡¶Ø‡ßã‡¶ó ‡¶π‡¶¨‡ßá
      });

      statusEl.textContent = "‚úÖ 10 ‡¶ï‡ßü‡ßá‡¶® ‡¶Ø‡ßã‡¶ó ‡¶π‡ßü‡ßá‡¶õ‡ßá!";
      claimBtn.disabled = true;
    });
  </script>
</body>
</html>
