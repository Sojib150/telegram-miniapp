<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Profile</title>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js"></script>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
</head>
<body class="bg-gray-100 flex items-center justify-center h-screen">
  <div class="bg-white shadow-lg rounded-2xl p-6 w-80 text-center">
    <img id="userPic" class="w-20 h-20 rounded-full mx-auto border-4 border-yellow-400" src="" alt="Profile">
    <h2 id="userName" class="mt-3 text-xl font-bold text-gray-800">Loading...</h2>
    <p id="userId" class="text-gray-500 text-sm">ID: ...</p>
    <div class="mt-4 p-3 bg-yellow-100 rounded-xl">
      <p class="text-gray-700 font-semibold">ðŸ’° Coins</p>
      <h3 id="coinBalance" class="text-2xl font-bold text-yellow-600">0</h3>
    </div>
  </div>

<script>
  // Firebase Config
  const firebaseConfig = {
    apiKey: "AIzaSyB6b93A_HeU4FADs3o2Ysw6-dlRRS2TbZk",
    authDomain: "telegram-miniapp-e8cc0.firebaseapp.com",
    projectId: "telegram-miniapp-e8cc0",
    storageBucket: "telegram-miniapp-e8cc0.firebasestorage.app",
    messagingSenderId: "827930913054",
    appId: "1:827930913054:web:502b56e0c198d8e9ff410f"
  };
  const app = firebase.initializeApp(firebaseConfig);
  const db = firebase.firestore();

  // Telegram User Data
  const tg = window.Telegram.WebApp;
  tg.ready();
  const user = tg.initDataUnsafe?.user;

  if(user){
    document.getElementById("userName").innerText = user.first_name + (user.last_name ? " " + user.last_name : "");
    document.getElementById("userId").innerText = "ID: " + user.id;
    if(user.photo_url){
      document.getElementById("userPic").src = user.photo_url;
    } else {
      document.getElementById("userPic").src = "https://i.pravatar.cc/100"; // fallback avatar
    }

    // Load Coin Balance
    db.collection("users").doc(user.id.toString()).get().then(doc=>{
      if(doc.exists){
        document.getElementById("coinBalance").innerText = doc.data().coins || 0;
      } else {
        db.collection("users").doc(user.id.toString()).set({coins:0});
        document.getElementById("coinBalance").innerText = 0;
      }
    });
  }
</script>
</body>
</html>
