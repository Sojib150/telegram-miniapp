<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Profile</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js"></script>
</head>
<body class="bg-light">

  <div class="container mt-5">
    <div class="card shadow-lg p-4 text-center">
      <img src="https://cdn-icons-png.flaticon.com/512/149/149071.png" 
           width="100" class="rounded-circle mx-auto mb-3" id="userPic">
      <h4 id="userName">Loading...</h4>
      <p class="text-muted" id="userId">Telegram ID: ...</p>
      <h5 class="mt-3">ðŸ’° Coins: <span id="userCoins">0</span></h5>
      <button class="btn btn-primary mt-3" onclick="logout()">Logout</button>
    </div>
  </div>

  <script type="module">
    // --- Firebase Config (à¦¤à§à¦®à¦¿ à¦†à¦—à§‡à¦‡ à¦¦à¦¿à§Ÿà§‡à¦›à§‹) ---
    const firebaseConfig = {
      apiKey: "AIzaSyB6b93A_HeU4FADs3o2Ysw6-dlRRS2TbZk",
      authDomain: "telegram-miniapp-e8cc0.firebaseapp.com",
      projectId: "telegram-miniapp-e8cc0",
      storageBucket: "telegram-miniapp-e8cc0.firebasestorage.app",
      messagingSenderId: "827930913054",
      appId: "1:827930913054:web:502b56e0c198d8e9ff410f"
    };

    // Firebase Init
    const app = firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    // Telegram User Info
    const tg = window.Telegram.WebApp;
    tg.expand();

    const user = tg.initDataUnsafe?.user;

    if (user) {
      document.getElementById("userName").innerText = user.first_name + " " + (user.last_name || "");
      document.getElementById("userId").innerText = "Telegram ID: " + user.id;

      // à¦¡à¦¿à¦«à¦²à§à¦Ÿ à¦ªà§à¦°à§‹à¦«à¦¾à¦‡à¦² à¦›à¦¬à¦¿
      if (user.photo_url) {
        document.getElementById("userPic").src = user.photo_url;
      }

      // Firestore à¦ à¦‡à¦‰à¦œà¦¾à¦° à¦¸à§‡à¦­ / à¦†à¦ªà¦¡à§‡à¦Ÿ
      const userRef = db.collection("users").doc(user.id.toString());

      userRef.get().then(doc => {
        if (!doc.exists) {
          userRef.set({
            name: user.first_name,
            username: user.username || "",
            coins: 100 // à¦¨à¦¤à§à¦¨ à¦‡à¦‰à¦œà¦¾à¦°à§‡à¦° à¦œà¦¨à§à¦¯ 100 à¦•à§Ÿà§‡à¦¨
          });
          document.getElementById("userCoins").innerText = 100;
        } else {
          document.getElementById("userCoins").innerText = doc.data().coins;
        }
      });

      // Realtime Update
      userRef.onSnapshot(doc => {
        if (doc.exists) {
          document.getElementById("userCoins").innerText = doc.data().coins;
        }
      });
    }

    function logout() {
      alert("Logout not required. Close Telegram MiniApp.");
    }
  </script>
</body>
</html>
